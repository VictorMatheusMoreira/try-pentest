import express from 'express'
import bodyParser from 'body-parser'
import { DatabasePostgres } from './database-postgres.js'
import { sql } from './db.js'

let app = express()
app.use(bodyParser.json())

const database = new DatabasePostgres()

app.post('/user', async (req, res) => {
    const {name, email, password} = req.body

    await database.create({
        name,
        email,
        password
    })

    return res.status(201).send()
})

app.get('/user', async (req, res) => {
    const user = await database.list()
    return user;
})

app.put('/user/:id', async (req, res) => {
    const {name, email, password} = req.body
    const id = req.params.id

    await database.update(id, {
        name,
        email,
        password
    }) 
    return res.status(204).send()

})

app.delete('/user/:id', async (req, res) => {
    const id = req.params.id

    await database.delete(id)
    return res.status(204).send()

})

app.get('/user/:email/:password', async (req, res) => {
     const email = req.params.email
     const password = req.params.password

      return await sql`SELECT * FROM users WHERE users.email = ${email}`
     
})



app.listen(3000, () => {
    console.log('server is running in 3000')
})